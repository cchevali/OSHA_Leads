name: Windows Secrets Wiring

on:
  push:
  pull_request:

jobs:
  windows:
    runs-on: windows-latest
    steps:
      - uses: actions/checkout@v4

      - name: Install sops + age (winget)
        shell: powershell
        run: |
          winget install --id Mozilla.SOPS -e --source winget --accept-package-agreements --accept-source-agreements
          winget install --id FiloSottile.age -e --source winget --accept-package-agreements --accept-source-agreements

      - name: Assert Task Wiring
        shell: powershell
        run: |
          powershell -NoProfile -ExecutionPolicy Bypass -File scripts\assert_task_wiring.ps1

      - name: Assert LF-Only SOPS Files
        shell: powershell
        run: |
          powershell -NoProfile -ExecutionPolicy Bypass -File scripts\assert_no_cr.ps1

      - name: Verify Secrets (Non-Secret Mode)
        shell: powershell
        run: |
          powershell -NoProfile -ExecutionPolicy Bypass -File scripts\verify_secrets.ps1 -NonSecret

